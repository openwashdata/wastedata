---
output: github_document
always_allow_html: true
editor_options: 
  markdown: 
    wrap: 72
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  message = FALSE,
  warning = FALSE,
  fig.retina = 2,
  fig.align = 'center'
)
```

# Waste Site and Cemetery Survey Data (2017-2018)

<!-- badges: start -->

[![License: CC BY
4.0](https://img.shields.io/badge/License-CC_BY_4.0-lightgrey.svg)](https://creativecommons.org/licenses/by/4.0/)

<!-- badges: end -->

This dataset contains survey records on cemeteries, burial grounds, and
waste disposal sites in Malawi. The information was gathered by
enumerators using the mWater application with support from the World
Food Programme (WFP). The primary purpose of this data collection was to
map and document waste management sites and burial grounds in order to
assess service coverage, evaluate environmental risks, and inform
planning for safe and sustainable waste management.

Each record captures details on site location, operational status,
management arrangements, and the history of site use. It also includes
information on the type and state of waste present, evidence of
pollution, sources of waste, and the population served by municipal
facilities. Additional entries document the types of operations at
municipal, commercial, industrial, and sludge waste sites, along with
practices related to drinking water and waste water treatment.

This dataset supports evidence-based decision-making in waste
management, environmental monitoring, and public health interventions.

**Potential users of the data**

1.  Government agencies – to plan and regulate waste management
    infrastructure, cemetery management, and environmental protection
    policies.

2.  Municipal councils and local authorities – to monitor service
    coverage, track landfill and cemetery operations, and identify gaps
    in waste disposal facilities.

3.  Public health institutions – to study links between waste disposal
    practices, pollution, and health risks to nearby communities.

4.  Environmental researchers and NGOs – to assess pollution risks,
    identify hotspots, and design interventions for safer waste and
    water management.

5.  Development partners (e.g., WFP, UNICEF, World Bank) – to inform
    project design, evaluate service delivery, and target investments in
    infrastructure.

6.  Academic institutions – to support research in environmental
    science, public health, and urban planning.

7.  Community advocacy groups – to hold local authorities accountable
    and push for improved waste management services.

## Installation

You can install the development version of wastedata from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("openwashdata/wastedata")
```

```{r}
## Run the following code in console if you don't have the packages
## install.packages(c("dplyr", "knitr", "readr", "stringr", "gt", "kableExtra"))
library(dplyr)
library(knitr)
library(readr)
library(stringr)
library(gt)
library(kableExtra)
```

Alternatively, you can download the individual datasets as a CSV or XLSX
file from the table below.

1.  Click Download CSV. A window opens that displays the CSV in your
    browser.
2.  Right-click anywhere inside the window and select "Save Page As...".
3.  Save the file in a folder of your choice.

```{r, echo=FALSE, message=FALSE, warning=FALSE}

extdata_path <- "https://github.com/openwashdata/wastedata/raw/main/inst/extdata/"

read_csv("data-raw/dictionary.csv") |> 
  distinct(file_name) |> 
  dplyr::mutate(file_name = str_remove(file_name, ".rda")) |> 
  dplyr::rename(dataset = file_name) |> 
  mutate(
    CSV = paste0("[Download CSV](", extdata_path, dataset, ".csv)"),
    XLSX = paste0("[Download XLSX](", extdata_path, dataset, ".xlsx)")
  ) |> 
  knitr::kable()

```

## Data

The package provides access to cemeteries, burial grounds, and waste disposal sites in Malawi.

```{r}
library(wastedata)
```

### metadata

The dataset `wastedata`  has `r nrow(wastedata)`
observations and `r ncol(wastedata)` variables

```{r}
wastedata |> 
  head(3) |> 
  gt::gt() |>
  gt::as_raw_html()
```

For an overview of the variable names, see the following table.

```{r echo=FALSE, message=FALSE, warning=FALSE}
readr::read_csv("data-raw/dictionary.csv") |>
  dplyr::filter(file_name == "metadata.rda") |>
  dplyr::select(variable_name:description) |> 
  knitr::kable() |> 
  kableExtra::kable_styling("striped") |> 
  kableExtra::scroll_box(height = "200px")
```

## Example

```{r}
library(wastedata)


# Visualization 1: Waste types
# Stacked bar chart: waste_state (Solid vs Liquid) by waste_category
# Purpose: Reveals dominant categories of waste and whether liquid waste is underrepresented.

library(dplyr)
library(ggplot2)

# Step 1: Clean and prepare the data
df_clean <- wastedata %>%
  mutate(
    # Group waste_state into Solid, Liquid, or Unknown
    waste_state_grouped = case_when(
      grepl("solid", tolower(waste_state)) ~ "Solid waste",
      grepl("liquid", tolower(waste_state)) ~ "Liquid waste",
      TRUE ~ "Unknown"   # Combines Not Known, NA, or anything else into Unknown
    ),
    # Standardize waste_category, combining Not Known and Unknown
    waste_category_clean = case_when(
      is.na(waste_category) | waste_category == "" ~ "Unknown",
      tolower(waste_category) %in% c("not known", "unknown") ~ "Unknown",
      TRUE ~ waste_category
    )
  ) %>%
  # Ensure no duplicate site entries per category/state combination
  distinct(submitted_on, latitude, longitude, waste_category_clean, waste_state_grouped)

# Step 2: Aggregate counts for each category-state combination
waste_counts <- df_clean %>%
  group_by(waste_category_clean, waste_state_grouped) %>%
  summarise(count = n(), .groups = "drop")

# Step 3: Create stacked bar chart
ggplot(waste_counts, aes(x = waste_category_clean, y = count, fill = waste_state_grouped)) +
  geom_bar(stat = "identity") +  # Use identity since we already counted
  labs(
    title = "Waste Types by Category",
    x = "Waste Category",
    y = "Number of Sites",
    fill = "Waste State"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for readability


# Visualization 2: Waste site operational status
# Purpose: Show a comparison between active and non active waste sites

# Load libraries
library(ggplot2)
library(dplyr)

# Prepare data
# Replace NA with Not Known
status_data <- wastedata %>%
  mutate(waste_active = case_when(
    is.na(waste_active) ~ "Not Known",
    waste_active == "" ~ "Not Known",
    TRUE ~ waste_active
  )) %>%
  group_by(waste_active) %>%
  summarise(count = n()) %>%
  ungroup()

# Create pie chart
ggplot(status_data, aes(x = "", y = count, fill = waste_active)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  labs(title = "Operational Status of Waste Sites",
       fill = "Waste Active") +
  theme_void() +
  geom_text(aes(label = paste0(waste_active, ": ", count)),
            position = position_stack(vjust = 0.5))


```

## License

Data are available as
[CC-BY](https://github.com/openwashdata/%7B%7B%7Bpackagename%7D%7D%7D/blob/main/LICENSE.md).

## Citation

Please cite this package using:

```{r}
citation("wastedata")
```
